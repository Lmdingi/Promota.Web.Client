@page "/account"
@layout EmptyLayout
@rendermode InteractiveServer
@inject GlobalEventCallBacks _globalEventCallBacks

<LoadingSpinner IsLoading="@IsLoading" />

<div class="flex-grow flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8 bg-white p-8 sm:p-10 rounded-xl shadow-xl">
        <div>
            <div class="flex justify-center mb-6">
                <button class="@GetTabClass("signIn")" @onclick="@(() => ShowTab("signIn"))">Sign In</button>
                <button class="@GetTabClass("signUp")" @onclick="@(() => ShowTab("signUp"))">Sign Up</button>
            </div>
        </div>

        @if (_activeTab == "signIn")
        {
            <Login></Login>
        }

        @if (_activeTab == "signUp")
        {
            <Register></Register>
        }
    </div>
</div>

@code {
    public bool IsLoading { get; set; }

    private string _activeTab = "signIn";

    protected override void OnInitialized()
    {
        base.OnInitialized();
        _globalEventCallBacks.OnString += HandleTabSelection;
        _globalEventCallBacks.OnBool += HandleLoadingSpinner;
    }
    
    private void HandleLoadingSpinner(bool isLoading)
    {
        _ = InvokeAsync(() =>
        {
            IsLoading = isLoading;
            StateHasChanged();
        });
    }

    private void HandleTabSelection(string msg)
    {
        _ = InvokeAsync(() =>
        {
            _activeTab = msg;
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        _globalEventCallBacks.OnString -= HandleTabSelection;
        _globalEventCallBacks.OnBool += HandleLoadingSpinner;
    }

    private void ShowTab(string tabName)
    {
        _activeTab = tabName;
    }

    private bool IsActiveTab(string tabName) => _activeTab == tabName;

    private string GetTabClass(string tabName) =>
        IsActiveTab(tabName)
            ? "w-1/2 py-3 px-4 border-b-2 border-pink-500 text-pink-500 font-semibold text-center focus:outline-none"
            : "w-1/2 py-3 px-4 border-b-2 border-gray-300 text-gray-500 font-semibold text-center hover:border-pink-400 hover:text-pink-400 focus:outline-none";
}
